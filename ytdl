__dependencies__ = ["yt-dlp>=2024.1.0"]

import os
from hikka import loader, utils

@loader.tds
class YTDLPMod(loader.Module):
    """ğŸ“¥ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²Ğ¸Ğ´ĞµĞ¾ Ñ‡ĞµÑ€ĞµĞ· yt-dlp"""
    strings = {"name": "YTDLP"}

    async def ytdlcmd(self, message):
        """Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: .ytdl <ÑÑÑ‹Ğ»ĞºĞ°>"""
        args = utils.get_args_raw(message)
        if not args:
            await message.edit("ğŸ’€ Ğ”Ğ°Ğ¹ ÑÑÑ‹Ğ»ĞºÑƒ, ÑƒĞ½Ğ¸Ñ‚Ğ°Ğ· ğŸ˜")
            return

        url = args.strip()
        path = f"/data/data/com.termux/files/home/downloads/video.mp4"

        await message.edit("ğŸ“¥ ĞšĞ°Ñ‡Ğ°Ñ... Ğ´ĞµÑ€Ğ¶Ğ¸ÑÑŒ ğŸ’€")

        cmd = f'yt-dlp -f "mp4" -o "{path}" "{url}"'

        proc = await utils.run_sync(os.system, cmd)

        if not os.path.exists(path):
            await message.edit("ğŸ’€ ĞĞµ ÑĞºĞ°Ñ‡Ğ°Ğ»Ğ¾ÑÑŒ, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ°Ğ¹Ñ‚ Ğ²Ñ‹Ğ¿ĞµĞ½Ğ´Ñ€Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ")
            return

        try:
            await message.client.send_file(message.chat_id, path)
            await message.delete()
        except Exception as e:
            await message.edit(f"ğŸ’€ ĞÑˆĞ¸Ğ±ĞºĞ°: {e}")
